# b00tl3gRSA2
Cryptography, 400 points

## Description:
> In RSA d is alot bigger than e, why dont we use d to encrypt instead of e?


## Solution: 

This challenge is similar to last year's [Super Safe RSA 2](/2018_picoCTF/Super%20Safe%20RSA%202.md).

Let's connect to the attached service:

```console
root@kali:/media/sf_CTFs/pico/b00tl3gRSA2# nc 2019shell1.picoctf.com 25894
c: 48071375616862534228176326528574885516709202280728491624113945638793071184006980266737279850050742118693709792242840439393541865811330474576169967674079123907090654398992126304860965521240238310796011949309914300123384015445484300373166609628216518116939428644164267538696119210897669664957903314187967291512
n: 92127679145864665544509285250839264498411738443717215748267905745029643874193055919184223323864056258655815094323958810858139536866236939854310538894340791381299415997654040768206426802287455505544556235998728826483952449687792000885283330274926207244242183386994582748534826366816341614902994131107305595311
e: 57162823211124109429817134983904174001913650793831222991402812445120854456264193141243988239339731505897127805599729329763879733999552297514925671812861027407779381128169655277743189409738606387376548984511780696518013594272105582951800971729070004788190602897517208334073609575019514843888968859835457405377
```

We see that `e` is very large, and the description suggests that `d` is much smaller (i.e. `d` and `e` were swapped).

The following two posts summarize why this is a bad idea:

* [RSA: Does it matter if you use e or d to encrypt?](https://crypto.stackexchange.com/questions/54557/rsa-does-it-matter-if-you-use-e-or-d-to-encrypt)
* [Why RSA uses {d,n} as private key instead of {e,n}?](https://crypto.stackexchange.com/questions/8460/why-rsa-uses-d-n-as-private-key-instead-of-e-n)

In short, if the secret exponent (usually denoted as `d`) is small, it is vulnerable to Wiener's attack.

We'll use `RsaCtfTool` to trigger the attack.

First, we create a PKCS#8 Public Key file from `e` and `n`, since that's the format the tool works with:
```console
root@kali:/media/sf_CTFs/pico/b00tl3gRSA2# python ~/utils/RsaCtfTool/RsaCtfTool.py --createpub  --e 57162823211124109429817134983904174001913650793831222991402812445120854456264193141243988239339731505897127805599729329763879733999552297514925671812861027407779381128169655277743189409738606387376548984511780696518013594272105582951800971729070004788190602897517208334073609575019514843888968859835457405377  --n 92127679145864665544509285250839264498411738443717215748267905745029643874193055919184223323864056258655815094323958810858139536866236939854310538894340791381299415997654040768206426802287455505544556235998728826483952449687792000885283330274926207244242183386994582748534826366816341614902994131107305595311 > key.pub
root@kali:/media/sf_CTFs/pico/b00tl3gRSA2# cat key.pub
-----BEGIN PUBLIC KEY-----
MIIBHzANBgkqhkiG9w0BAQEFAAOCAQwAMIIBBwKBgQCDMbUe0lvVv2oOZShmsIgx
agO+cSGBCWjpXcSdZsjB+FEPY6EUEPd/9C+xEzt1OMPa1W+rsDNj60jGjyU/RbnU
SPrMVXkLEp/EV+sLbhu0QIGaYYivmyfQAUUsVPwjKMZAvq997n29lSJjCBa0Vre4
e4pFDfLxu8j+YCHDyjWhrwKBgFFnDlLJg2HlGxFDgwX0kwzWEuyflYJTLF1gaRah
J//y65j44IFq5abnBJCCtmnNhvjJZjjJY5mj68wIFbxkryA7mUnGJjlPnfklediL
ngb1snR9wpC6w3Hp5x2vQLJpx2hZDCzMvA2cadCyrss/jWdzvVQ7CSLsP3TmksYP
VQHB
-----END PUBLIC KEY-----
```

Then we convert the ciphertext to binary:
```console
root@kali:/media/sf_CTFs/pico/b00tl3gRSA2# c=48071375616862534228176326528574885516709202280728491624113945638793071184006980266737279850050742118693709792242840439393541865811330474576169967674079123907090654398992126304860965521240238310796011949309914300123384015445484300373166609628216518116939428644164267538696119210897669664957903314187967291512
root@kali:/media/sf_CTFs/pico/b00tl3gRSA2# echo "obase=16; $c" | BC_LINE_LENGTH=0 bc | awk '{ print (length($0) % 2 == 0) ? $0 : 0$0; }' | xxd -p -r > c.bin
root@kali:/media/sf_CTFs/pico/b00tl3gRSA2# xxd -g 1 c.bin
00000000: 44 74 b6 98 70 33 7d 78 5d ca 5a dc 2c ea c3 a5  Dt..p3}x].Z.,...
00000010: 6c 38 1c b0 27 15 67 a5 19 ce 19 1c eb 57 81 1e  l8..'.g......W..
00000020: ab cd 62 e1 11 c9 af 88 ce 1a ef 27 cc 2d eb 28  ..b........'.-.(
00000030: 60 39 27 8e 08 2c 9b 3f d3 31 b5 fd 2e 70 c1 cb  `9'..,.?.1...p..
00000040: 51 ec 6a bb 05 8e 0b 30 33 42 ad 77 61 4b cd 3f  Q.j....03B.waK.?
00000050: 43 78 15 21 c3 43 7f c8 14 84 ab 03 e4 97 ca d3  Cx.!.C..........
00000060: 19 10 37 ea db f4 9e 1d 0d 8a 52 da e8 df 2f 83  ..7.......R.../.
00000070: 84 b3 45 3d 01 ec e9 59 52 9d d0 ff 23 30 60 78  ..E=...YR...#0`x
```

Finally, we trigger the tool to uncipher the text:
```console
root@kali:/media/sf_CTFs/pico/b00tl3gRSA2# python ~/utils/RsaCtfTool/RsaCtfTool.py  --publickey key.pub --private --uncipher c.bin  --verbose
[*] Performing hastads attack.
[*] Performing factordb attack.
[*] Performing pastctfprimes attack.
[*] Loaded 71 primes
[*] Performing noveltyprimes attack.
[*] Performing smallq attack.
[*] Performing wiener attack.
-----BEGIN RSA PRIVATE KEY-----
MIIB4QIBAAKBgQCDMbUe0lvVv2oOZShmsIgxagO+cSGBCWjpXcSdZsjB+FEPY6EU
EPd/9C+xEzt1OMPa1W+rsDNj60jGjyU/RbnUSPrMVXkLEp/EV+sLbhu0QIGaYYiv
myfQAUUsVPwjKMZAvq997n29lSJjCBa0Vre4e4pFDfLxu8j+YCHDyjWhrwKBgFFn
DlLJg2HlGxFDgwX0kwzWEuyflYJTLF1gaRahJ//y65j44IFq5abnBJCCtmnNhvjJ
ZjjJY5mj68wIFbxkryA7mUnGJjlPnfklediLngb1snR9wpC6w3Hp5x2vQLJpx2hZ
DCzMvA2cadCyrss/jWdzvVQ7CSLsP3TmksYPVQHBAgMBAAECQQCgeR9tnH4TLS3e
q0KUgWMWFn4eeAFhyCrcNAGGLAI1Sgqha+zNbmDgogA9e6rSLSy6FBIuiOLd54WW
s1RtEX4TAkEA0Uqxy2fpRziDahId7kLRkgIWeADtGFvjgxcP+WF39uYDPmzhACq+
z6a7JuAmSTVWHGOQclewJgmN5tiStMFRdQIDAQABAgMBAAECQE9tBqDnKy8O+uw8
VzSuA8/EXqpCQmmLYyke9Izu42z/xSJqDUX7ZmUBwxcaeZrx152ob/EMcNFrSMq8
eEN9+D8=
-----END RSA PRIVATE KEY-----
[+] Clear text : picoCTF{bad_1d3a5_3468581}
```